<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.beonse2.domain.reviewBoard.mapper.ReviewBoardMapper">

<!--    <sql id="reviewColumns">
    <![CDATA[
          rbid
        , memberId
        , branchId
        , title
        , content
        , status
        , createAt
        , modifiedAt
    ]]>
    </sql>-->

<!--    <resultMap id="boardMap" type="BoardDTO">-->
<!--        <id column="RBID" property="rbId"/>-->
<!--        <result column="MEMBER_MID" property="memberId" />-->
<!--        <result column="BRANCH_BID" property="branchId" />-->
<!--        <result column="TITLE" property="title" />-->
<!--        <result column="CONTENT" property="content" />-->
<!--        <result column="STATUS" property="status" />-->
<!--        <result column="IMAGE" property="image" />-->
<!--        <result column="CREATE_AT" property="createAt" />-->
<!--        <result column="MODIFIED_AT" property="modifiedAt" />-->

<!--        <association property="memberDTO" javaType="MemberDTO">-->
<!--            <id column="MID" property="mId"/>-->
<!--            <result column="NAME" property="name" />-->
<!--        </association>-->
<!--    </resultMap>-->

<!-- 게시글 작성 -->
    <insert id="createReviewBoard" parameterType="com.beonse2.domain.reviewBoard.dto.ReviewBoardDTO" >
        INSERT INTO REVIEWBOARD(RBID, MEMBER_MID, BRANCH_BID, TITLE, CONTENT, STATUS, IMAGE, CREATED_AT, MODIFIED_AT)
        VALUES (REVIEWBOARD_SEQ.nextval, 1, 1, #{title}, #{content}, 0,
                                    <choose>
                                        <when test="image != null">
                                            #{image},
                                        </when>
                                        <otherwise>
                                            NULL,
                                        </otherwise>
                                    </choose>
                                     sysdate, sysdate)
    </insert>

<!--게시글 조회-->
    <select id="reviewBoardList" parameterType="Long" resultType="com.beonse2.domain.reviewBoard.dto.ReviewBoardDTO">
        SELECT R.RBID, R.MEMBER_MID, M.EMAIL AS WRITER, R.BRANCH_BID, B.NAME AS BRANCHNAME, R.TITLE, R.CONTENT, R.STATUS, R.IMAGE, R.CREATED_AT, R.MODIFIED_AT
        FROM REVIEWBOARD R, MEMBER M, BRANCH B
        WHERE R.MEMBER_MID = M.MID
        AND R.BRANCH_BID = B.BID
        ORDER BY R.CREATED_AT DESC
    </select>

<!--단일 조회-->
    <select id="findByReviewBoardId" resultType="com.beonse2.domain.reviewBoard.dto.ReviewBoardDTO" parameterType="Long">

        SELECT
            R.RBID,
            R.MEMBER_MID,
            M.EMAIL AS WRITER,
            R.BRANCH_BID,
            B.NAME AS BRANCHNAME,
            R.TITLE,
            R.CONTENT,
            R.STATUS,
            R.IMAGE,
            R.CREATED_AT,
            R.MODIFIED_AT
        FROM
            REVIEWBOARD R, MEMBER M, BRANCH B
        WHERE
            R.MEMBER_MID = M.MID
          AND R.BRANCH_BID = B.BID
          AND R.RBID = #{rbid}
        ORDER BY
            R.CREATED_AT DESC
    </select>

    <!--게시글 수정-->
    <update id="updateReviewBoard" parameterType="com.beonse2.domain.reviewBoard.dto.ReviewBoardDTO">
        UPDATE REVIEWBOARD
        SET TITLE = #{title}, CONTENT = #{content},
        <choose>
            <when test="image != null">
               IMAGE =  #{image},
            </when>
            <otherwise>
                IMAGE =  NULL,
            </otherwise>
        </choose>
            MODIFIED_AT = sysdate WHERE RBID = #{rbId}
    </update>

<!--게시글 삭제-->
    <update id="deleteReviewBoard" parameterType="Long">
        UPDATE REVIEWBOARD
        SET
            STATUS = 1
        WHERE
            RBID = #{rbId}
    </update>
</mapper>